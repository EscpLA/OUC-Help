(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["subpkg/editProfile/editProfile"],{"47cc":function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=u(n("a34a")),a=(u(n("1057")),u(n("15ff"))),o=n("26cb");function u(e){return e&&e.__esModule?e:{default:e}}function s(e,t,n,r,a,o,u){try{var s=e[o](u),i=s.value}catch(c){return void n(c)}s.done?t(i):Promise.resolve(i).then(r,a)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function u(e){s(o,r,a,u,i,"next",e)}function i(e){s(o,r,a,u,i,"throw",e)}u(void 0)}))}}function c(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?c(Object(n),!0).forEach((function(t){l(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var f={data:function(){return{newAvatarUrl:"",md5Arr:[],majors:[],grades:[],gradeID:-1,majorID:-1,map:{text:"grade",value:"id"},tempFilePaths:[],avatarUrl:""}},computed:d({},(0,o.mapState)("m_user",["token","userInfo","stuInfo","leftNav","majorAndGrade"])),methods:d(d({},(0,o.mapMutations)("m_user",["updateStuInfo","updateMandG"])),{},{changePhoto:function(){var t=this,n=this;e.chooseImage({count:1,success:function(e){n.tempFilePaths=e.tempFilePaths,n.newAvatarUrl=n.tempFilePaths[0],console.log("that.tempFilePaths",n.tempFilePaths),n.md5Arr.push(a.default.hex_md5(n.tempFilePaths)),t.uploadImg()}})},uploadImg:function(){var t=this;return i(r.default.mark((function n(){var a,o,u,s,i,c,d,l;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return console.log("-----------uploadImg()---------"),a="https://dryang-miniapp.oss-accelerate.aliyuncs.com",n.next=4,e.$http.post("/get_token/");case 4:o=n.sent,u=o.data,s=u.result.host,i=u.result.signature,c=u.result.AccessKeyId,d=u.result.policy,console.log("res",u),l="ouchelp/"+t.md5Arr[0]+t.tempFilePaths[0].split(".")[1],e.uploadFile({url:s,filePath:t.tempFilePaths[0],name:"file",formData:{key:l,policy:d,ossAccessKeyId:c,signature:i},success:function(e){204===e.statusCode?(t.newAvatarUrl=a+"/"+l,console.log("this.newAvatarUrl: ",t.newAvatarUrl),t.updateAvatar()):console.log("请求成功，但是上传失败！")},fail:function(e){console.log("请求失败！"),reject("请求失败！")}});case 13:case"end":return n.stop()}}),n)})))()},updateAvatar:function(){var t=this;return i(r.default.mark((function n(){var a,o,u;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$http.post("/ChangeInfo/",{openid:t.token,type:1,picture:t.newAvatarUrl});case 2:if(a=n.sent,o=a.data,"200"==o.code){n.next=6;break}return n.abrupt("return",e.$showMsg("请稍后重试",1500,"error"));case 6:return u=t.stuInfo,u.depart_pictureID__picture_address=t.newAvatarUrl,t.updateStuInfo(u),n.abrupt("return",e.$showMsg("修改成功",1500,"success"));case 10:case"end":return n.stop()}}),n)})))()},goToEdit:function(t){e.navigateTo({url:"/subpkg/edit/edit?type="+t})},getGradeAndMajor:function(){var t=this;return i(r.default.mark((function n(){var a,o;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$http.post("/GradeAndMajor/");case 2:a=n.sent,o=a.data,console.log("res",o),t.grades=o.grade,t.majors=o.majorlist,t.updateMandG(o);case 8:case"end":return n.stop()}}),n)})))()},onGradeChange:function(e){void 0==e.detail.value[0]?this.$data.gradeID=-1:-1==this.$data.majorID&&this.$refs.majorPicker.show(),console.log("gradeId",this.$data.gradeID)},onMajorChange:function(e){void 0==e.detail.value[0]&&(this.$data.majorID=-1),this.changeMajAndGrd()},changeMajAndGrd:function(){var t=this;return i(r.default.mark((function n(){var a,o;return r.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,e.$http.post("/ChangeInfo/",{openid:t.token,type:4,gradeID:t.gradeID,majorID:t.majorID});case 2:if(a=n.sent,o=a.data,200==o.code){n.next=6;break}return n.abrupt("return",e.$showMsg("请稍后重试",1500,"error"));case 6:return n.abrupt("return",e.$showMsg("修改成功",1500,"success"));case 7:case"end":return n.stop()}}),n)})))()}}),onLoad:function(){"{}"==JSON.stringify(this.majorAndGrade)?this.getGradeAndMajor():(this.grades=this.majorAndGrade.grade,this.majors=this.majorAndGrade.majorlist)},onShow:function(){console.log(this.userInfo),console.log(this.leftNav)}};t.default=f}).call(this,n("543d")["default"])},"4cd5":function(e,t,n){"use strict";n.r(t);var r=n("47cc"),a=n.n(r);for(var o in r)"default"!==o&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t["default"]=a.a},"72a7":function(e,t,n){"use strict";(function(e){n("6e5e");r(n("66fd"));var t=r(n("8799"));function r(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=n,e(t.default)}).call(this,n("543d")["createPage"])},"7af9":function(e,t,n){},8799:function(e,t,n){"use strict";n.r(t);var r=n("dcd4"),a=n("4cd5");for(var o in a)"default"!==o&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("9a31");var u,s=n("f0c5"),i=Object(s["a"])(a["default"],r["b"],r["c"],!1,null,null,null,!1,r["a"],u);t["default"]=i.exports},"9a31":function(e,t,n){"use strict";var r=n("7af9"),a=n.n(r);a.a},dcd4:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"a",(function(){return r}));var r={uniIcons:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-icons/components/uni-icons/uni-icons")]).then(n.bind(null,"ca0b"))},uniDataPicker:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-data-picker/components/uni-data-picker/uni-data-picker")]).then(n.bind(null,"d337"))}},a=function(){var e=this,t=e.$createElement;e._self._c},o=[]}},[["72a7","common/runtime","common/vendor"]]]);