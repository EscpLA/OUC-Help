(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/me-signUp/me-signUp"],{5581:function(t,e,r){"use strict";var a=r("dd3c"),n=r.n(a);n.a},"55f1":function(t,e,r){"use strict";r.r(e);var a=r("bb8f"),n=r("b106");for(var o in n)"default"!==o&&function(t){r.d(e,t,(function(){return n[t]}))}(o);r("5581");var u,s=r("f0c5"),i=Object(s["a"])(n["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],u);e["default"]=i.exports},a898:function(t,e,r){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=u(r("a34a")),n=(u(r("861e")),u(r("15ff"))),o=r("26cb");function u(t){return t&&t.__esModule?t:{default:t}}function s(t,e,r,a,n,o,u){try{var s=t[o](u),i=s.value}catch(c){return void r(c)}s.done?e(i):Promise.resolve(i).then(a,n)}function i(t){return function(){var e=this,r=arguments;return new Promise((function(a,n){var o=t.apply(e,r);function u(t){s(o,a,n,u,i,"next",t)}function i(t){s(o,a,n,u,i,"throw",t)}u(void 0)}))}}function c(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,a)}return r}function l(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?c(Object(r),!0).forEach((function(e){d(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function d(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var f={name:"me-signUp",data:function(){return{avatarUrl:"https://mmbiz.qpic.cn/mmbiz/icTdbqWNOwNRna42FI242Lcia07jQodd2FJGIYQfG0LAJGFxM4FbnQP6yfMxBgJ0F3YRqJCJ1aPAK2dQagdusBZg/0",tempAvatarUrl:"",md5Arr:[],nickName:"",stuNumber:"",grade:"",major:"",tele:"",grades:[{value:1,text:"2019级"},{value:2,text:"2020级"},{value:3,text:"2021级"},{value:4,text:"2022级"}],majors:[{value:0,text:"数据科学与大数据i技术"}],gradeID:-1,majorID:-1,map:{text:"grade",value:"id"}}},computed:l({},(0,o.mapState)("m_user",["token"])),methods:l(l({},(0,o.mapMutations)("m_user",["updateSignUp","updateStuInfo","updateMandG"])),{},{getGradeAndMajor:function(){var e=this;return i(a.default.mark((function r(){var n,o;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.$http.post("/GradeAndMajor/");case 2:n=r.sent,o=n.data,console.log("res",o),e.$data.grades=o.grade,e.$data.majors=o.majorlist,e.updateMandG(o);case 8:case"end":return r.stop()}}),r)})))()},save:function(e){this.nickName=e.detail.value.nickName;var r=/^\d{8,12}$/,a=/^([1][3,4,5,6,7,8,9])\d{9}$/;return""==this.tempAvatarUrl?t.$showMsg("请选择头像"):""==this.nickName?t.$showMsg("请输入昵称"):0==r.test(this.stuNumber)?t.$showMsg("学号不符合规范"):0==a.test(this.tele)?t.$showMsg("请输入合法的电话号码"):void this.uploadImg()},submit:function(){var e=this;return i(a.default.mark((function r(){var n,o,u;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return n={nickName:e.$data.nickName,phone:e.$data.tele,student_number:e.$data.stuNumber,openid:e.token,depart_majorID:e.$data.majorID+"",depart_gradeID:e.$data.gradeID+"",depart_picture:e.avatarUrl},console.log("query",n),r.next=4,t.$http.post("/register/",n);case 4:if(o=r.sent,u=o.data,console.log("res",u),200!==u.code){r.next=13;break}return e.updateStuInfo(u.stuInfo[0]),console.log("res.stuInfo[0]: ",u.stuInfo[0]),r.abrupt("return",t.$showMsg(u.msg));case 13:return r.abrupt("return",t.$showMsg(u.msg));case 14:case"end":return r.stop()}}),r)})))()},onGradeChange:function(t){void 0==t.detail.value[0]?this.$data.gradeID=-1:-1==this.$data.majorID&&this.$refs.majorPicker.show(),console.log("gradeId",this.$data.gradeID)},onMajorChange:function(t){void 0==t.detail.value[0]&&(this.$data.majorID=-1)},onChooseAvatar:function(t){var e=t.detail.avatarUrl;this.avatarUrl=e,this.tempAvatarUrl=e,this.md5Arr.push(n.default.hex_md5(this.tempAvatarUrl)),console.log("this.md5Arr: ",this.md5Arr),console.log("this.tempAvatarUrl: ",this.tempAvatarUrl)},uploadImg:function(){var e=this;return i(a.default.mark((function r(){var n,o,u,s,i,c,l,d;return a.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return console.log("-----------uploadImg()---------"),n="https://dryang-miniapp.oss-accelerate.aliyuncs.com",r.next=4,t.$http.post("/get_token/");case 4:o=r.sent,u=o.data,s=u.result.host,i=u.result.signature,c=u.result.AccessKeyId,l=u.result.policy,console.log("res",u),d="ouchelp/"+e.md5Arr[0]+e.tempAvatarUrl.split(".")[1],t.uploadFile({url:s,filePath:e.tempAvatarUrl,name:"file",formData:{key:d,policy:l,ossAccessKeyId:c,signature:i},success:function(t){204===t.statusCode?(e.avatarUrl=n+"/"+d,console.log("this.avatarUrl: ",e.avatarUrl),e.submit()):(console.log("请求成功，但是上传失败！"),reject("请求成功，但是上传失败！"))},fail:function(t){console.log("请求失败！"),reject("请求失败！")}});case 13:case"end":return r.stop()}}),r)})))()}}),created:function(){this.getGradeAndMajor()}};e.default=f}).call(this,r("543d")["default"])},b106:function(t,e,r){"use strict";r.r(e);var a=r("a898"),n=r.n(a);for(var o in a)"default"!==o&&function(t){r.d(e,t,(function(){return a[t]}))}(o);e["default"]=n.a},bb8f:function(t,e,r){"use strict";r.d(e,"b",(function(){return n})),r.d(e,"c",(function(){return o})),r.d(e,"a",(function(){return a}));var a={uniDataPicker:function(){return Promise.all([r.e("common/vendor"),r.e("uni_modules/uni-data-picker/components/uni-data-picker/uni-data-picker")]).then(r.bind(null,"d337"))}},n=function(){var t=this,e=t.$createElement;t._self._c},o=[]},dd3c:function(t,e,r){}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/me-signUp/me-signUp-create-component',
    {
        'components/me-signUp/me-signUp-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("55f1"))
        })
    },
    [['components/me-signUp/me-signUp-create-component']]
]);
