{"version":3,"sources":["webpack:///C:/Users/hp/Documents/HBuilderProjects/OUC_help/subpkg/uploadGoods/uploadGoods.vue?2f98","webpack:///C:/Users/hp/Documents/HBuilderProjects/OUC_help/subpkg/uploadGoods/uploadGoods.vue?4fce","webpack:///C:/Users/hp/Documents/HBuilderProjects/OUC_help/subpkg/uploadGoods/uploadGoods.vue?a1ae","webpack:///C:/Users/hp/Documents/HBuilderProjects/OUC_help/subpkg/uploadGoods/uploadGoods.vue?d01d","uni-app:///subpkg/uploadGoods/uploadGoods.vue","webpack:///C:/Users/hp/Documents/HBuilderProjects/OUC_help/subpkg/uploadGoods/uploadGoods.vue?3ca6","uni-app:///main.js"],"names":["renderjs","component","options","__file","components","uniDataPicker","uniFilePicker","uniDatetimePicker","e","message","indexOf","console","error","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped","wx","__webpack_require_UNI_MP_PLUGIN__","__webpack_require__","createPage","Page"],"mappings":"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","file":"subpkg/uploadGoods/uploadGoods.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./uploadGoods.vue?vue&type=template&id=28ba7fb4&\"\nvar renderjs\nimport script from \"./uploadGoods.vue?vue&type=script&lang=js&\"\nexport * from \"./uploadGoods.vue?vue&type=script&lang=js&\"\nimport style0 from \"./uploadGoods.vue?vue&type=style&index=0&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"subpkg/uploadGoods/uploadGoods.vue\"\nexport default component.exports","export * from \"-!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uploadGoods.vue?vue&type=template&id=28ba7fb4&\"","var components\ntry {\n  components = {\n    uniDataPicker: function() {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-data-picker/components/uni-data-picker/uni-data-picker\" */ \"@/uni_modules/uni-data-picker/components/uni-data-picker/uni-data-picker.vue\"\n      )\n    },\n    uniFilePicker: function() {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker\" */ \"@/uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.vue\"\n      )\n    },\n    uniDatetimePicker: function() {\n      return import(\n        /* webpackChunkName: \"uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker\" */ \"@/uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker.vue\"\n      )\n    }\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uploadGoods.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uploadGoods.vue?vue&type=script&lang=js&\"","<template>\r\n  <view class=\"container\">\r\n    <view class=\"infoBox\">\r\n      <!-- 物品类型 -->\r\n      <view class=\"goodsTypeBox infoBoxItem\">\r\n        <view class=\"textbox\">\r\n          <text class=\"infoText\">物品类型</text>\r\n        </view>\r\n        <view class=\"uniDataPicker\">\r\n          <uni-data-picker placeholder=\"请选择物品类型\" popup-title=\"请选择物品类型\" :localdata=\"dataTree\" v-model=\"classes\"\r\n            @change=\"onchange\" class=\"uniDataPicker\" :placeholderSize=\"16\">\r\n          </uni-data-picker>\r\n        </view>\r\n      </view>\r\n      <!-- 物品名称 -->\r\n      <view class=\"goodsNameBox infoBoxItem\">\r\n        <view class=\"textbox\">\r\n          <text class=\"infoText\">物品名称</text>\r\n        </view>\r\n        <input placeholder=\"请输入物品名称\" v-model=\"itemName\" type=\"text\">\r\n      </view>\r\n      <!-- 物品描述 -->\r\n      <view class=\"goodsDescBox infoBoxItem\">\r\n        <view class=\"textbox\">\r\n          <text class=\"infoText\">物品描述</text>\r\n        </view>\r\n        <input placeholder=\"请输入物品描述\" v-model=\"description\" type=\"text\">\r\n      </view>\r\n      <!-- 选择图片 -->\r\n      <view class=\"goodsDescBox infoBoxItem\">\r\n        <view class=\"textbox\">\r\n          <text class=\"infoText\">选择图片</text>\r\n        </view>\r\n        <view class=\"fileUpload\" @click=\"uniFilePickerCLick\">\r\n          <uni-file-picker v-model=\"uploadImgs\" returnType=\"array\" title=\"最多选择6张图片\" limit=\"6\" fileMediatype=\"image\"\r\n            file-extname=\"png,jpg\" :imageStyles=\"imageStyles\" @select=\"select\" @delete=\"fileDelete\"></uni-file-picker>\r\n        </view>\r\n      </view>\r\n\r\n      <!-- 物品颜色 -->\r\n      <view class=\"goodsDescBox infoBoxItem\">\r\n        <view class=\"textbox\">\r\n          <text class=\"infoText\">物品颜色</text>\r\n        </view>\r\n        <input placeholder=\"请输入物品颜色\" v-model=\"itemColor\">\r\n      </view>\r\n\r\n      <!-- 遗失时间 -->\r\n      <view class=\"goodsDescBox infoBoxItem\">\r\n        <view class=\"textbox\">\r\n          <text class=\"infoText\">{{query.type == 1 ? '遗失' : '拾到'}}时间</text>\r\n        </view>\r\n        <uni-datetime-picker type=\"date\" v-model=\"time\" @maskClick=\"maskClick\" :end=\"nowDate\" />\r\n      </view>\r\n\r\n      <!-- 遗失地点 -->\r\n      <view class=\"goodsDescBox infoBoxItem\">\r\n        <view class=\"textbox\">\r\n          <view class=\"infoText\">{{query.type == 1 ? '遗失' : '拾到'}}地点 &nbsp; <view class=\"smallText\">(可省略)</view>\r\n          </view>\r\n        </view>\r\n        <input :placeholder=\"`请输入${query.type==1 ? '遗失' : '拾到' }地点`\" v-model=\"position\" @click=\"addressClickHandler\">\r\n      </view>\r\n\r\n      <!-- 备注 -->\r\n      <!-- <view class=\"goodsDescBox infoBoxItem\">\r\n        <view class=\"textbox\">\r\n          <text class=\"infoText\">备注</text>\r\n        </view>\r\n        <input placeholder=\"请输入备注\" v-model=\"description\">\r\n      </view> -->\r\n    </view>\r\n    <button class=\"upBtn\" @click=\"MyUpload\">\r\n      <text class>发布</text>\r\n    </button>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\n  // md5 加密文件\r\n  import md5 from '../../utils/md5.js'\r\n  import {\r\n    mapActions,\r\n    mapState\r\n  } from 'vuex'\r\n  import store from '../../store/store.js'\r\n  import crypto from 'crypto-js'\r\n  import base64 from 'base-64'\r\n  export default {\r\n    data() {\r\n      return {\r\n        // 物品类型选择的 id，和输入框双向数据绑定\r\n        classes: 0,\r\n\r\n        //用户传参\r\n        query: {},\r\n\r\n        // 用户上传的图像数据：\r\n        uploadImgs: [],\r\n        // 物品名称\r\n        itemName: \"\",\r\n        // 物品颜色\r\n        itemColor: \"\",\r\n        time: \"\",\r\n        position: \"\",\r\n        description: \"\",\r\n\r\n        // 上传的图片的样式 \r\n        imageStyles: {\r\n          \"height\": 75, // 边框高度\r\n          \"width\": 75, // 边框宽度\r\n          \"border\": { // 如果为 Boolean 值，可以控制边框显示与否\r\n            \"color\": \"#eee\", // 边框颜色\r\n            \"width\": \"1px\", // 边框宽度\r\n            \"style\": \"solid\", // 边框样式\r\n            \"radius\": \"15px\" // 边框圆角，支持百分比\r\n          }\r\n        },\r\n\r\n        md5Arr: [],\r\n        // file-picker 产生的图片临时地址\r\n        tempPaths: [],\r\n\r\n        // 表示图片是否正在进行ocr识别\r\n        ocring: null,\r\n        // ocr识别出来的学号结果\r\n        ocrResStuNum: '',\r\n        // ocr识别出来的姓名结果 \r\n        ocrResName: '',\r\n        // 用户选择校园卡时，提示的文字\r\n        stuCardText: '在上传校园卡的照片时，请将有信息的图片置于第一张。',\r\n\r\n        // 今日时间\r\n        nowDate: \"\",\r\n        dataTree: [],\r\n        // 表示帖子正在上传中，用于组织用户多次点击按钮，之发送一次请求。\r\n        uploading: false,\r\n      };\r\n    },\r\n    methods: {\r\n\r\n      // 映射 Actions 方法\r\n      ...mapActions('m_user', ['getOSSToken']),\r\n\r\n      uniFilePickerCLick() {},\r\n\r\n      // 图片选取\r\n      select(e) {\r\n        e.tempFilePaths.forEach((each) => {\r\n          this.$data.md5Arr.push(md5.hex_md5(each))\r\n          this.$data.tempPaths.push(each)\r\n        })\r\n        // this.getSignature()\r\n      },\r\n\r\n      // 图片删除\r\n      fileDelete(e) {\r\n        console.log(e);\r\n        // 获取被删除图片的path\r\n        var del_path = e.tempFilePath;\r\n        var i = 0;\r\n        // 寻找被删除图片的在 md5Arr 中的下标\r\n        while (this.$data.tempPaths[i] != del_path) {\r\n          i++\r\n        }\r\n        // console.log(i);\r\n        // 删除数组该下标处的元素\r\n        this.$data.tempPaths.splice(i, 1)\r\n        this.$data.md5Arr.splice(i, 1)\r\n      },\r\n\r\n      // 上传图片，返回 promise 对象，方便 for 循环调用\r\n      // path 为文件名 ，ext为扩展名\r\n      uploadImg(res, path, filePath, ext) {\r\n        return new Promise(function(resolve, reject) {\r\n          // console.log('开始上传图片');\r\n          // OSS 上传地址\r\n          const host = res.result.host\r\n          const signature = res.result.signature\r\n          const ossAccessKeyId = res.result.AccessKeyId\r\n          const policy = res.result.policy\r\n          // key 表示文件在 OSS 中的存储路径\r\n          // 标准路径格式如下: ouchelp/md5.png\r\n          var key = \"ouchelp/\" + path + '.' + ext;\r\n          // console.log(\"key\", key);\r\n          // 1. 把图片上传到 OSS 中。\r\n          uni.uploadFile({\r\n            url: host,\r\n            filePath: filePath, // 需要存储到 OSS 中的图片的当前路径\r\n            name: 'file', // 必填 file\r\n            formData: {\r\n              key,\r\n              policy,\r\n              ossAccessKeyId,\r\n              signature,\r\n              // 'x-oss-security-token': SecurityToken // 使用STS签名时必传。\r\n            },\r\n            success: (res) => {\r\n              // console.log(\"res\", res);\r\n              if (res.statusCode === 204) {\r\n                // console.log(\"图片下标\" + i + \"上传成功，其文件路径：\", key)\r\n                resolve(key)\r\n              } else {\r\n                console.log(\"请求成功，但是上传失败！\");\r\n                reject('请求成功，但是上传失败！')\r\n              }\r\n            },\r\n            fail: (err) => {\r\n              console.log(\"请求失败！\");\r\n              reject('请求失败！')\r\n            }\r\n          })\r\n        })\r\n      },\r\n\r\n      // 将经过 md5 加密后的图片上传到 OSS 平台和服务器。\r\n      async uploadToOSS() {\r\n\r\n        // oss 文件加速访问域名\r\n        const downloadUrl = 'https://dryang-miniapp.oss-accelerate.aliyuncs.com'\r\n        // 创建时间戳，可以用于作为文件夹\r\n        let timeStamp = new Date().getTime()\r\n        const {\r\n          data: res\r\n        } = await uni.$http.post('/get_token/')\r\n        // console.log('/get_token/', res);\r\n        // 用 uni.uploadFile 把图片上传到 OSS 中，每次 uni.uploadFile 只能上传一张图片，因此这里用 for 循环调用 uni.uploadFile 接口，上传多张图片。\r\n        // promise 任务数组\r\n        let promiseTasks = []\r\n        // 向 promise 数组中push入promise 对象\r\n        for (var i = 0; i < this.$data.md5Arr.length; i++) {\r\n          promiseTasks.push(this.uploadImg(res, this.$data.md5Arr[i], this.$data.tempPaths[i], this.$data.tempPaths[i]\r\n            .split('.')[1]))\r\n        }\r\n        Promise.all(promiseTasks).then(key => {\r\n          // key 是一个数组\r\n          // console.log('promise执行顺序下：', key);\r\n          key.forEach(each => {\r\n            this.$data.uploadImgs.push(downloadUrl + '/' + each)\r\n          })\r\n        }).catch((err) => {\r\n          // console.log(\"err:\", err);\r\n        })\r\n      },\r\n\r\n      // 如果用户的图片类型为校园卡，则调用下面的 ocr 识别算法，识别学号\r\n\r\n      async getOcr() {\r\n        this.ocring = true;\r\n        console.log('getOcr');\r\n        wx.serviceMarket.invokeService({\r\n          service: 'wx79ac3de8be320b71', // '固定为服务商OCR的appid，非小程序appid',\r\n          api: 'OcrAllInOne',\r\n          data: {\r\n            img_url: this.uploadImgs[0],\r\n            data_type: 3,\r\n            ocr_type: 8,\r\n          },\r\n        }).then(res => {\r\n          console.log('invokeService success', res)\r\n          // 将ocr识别结果赋值到本地\r\n          let ocrRes = res.data.ocr_comm_res.items;\r\n          console.log('ocrRes: ', ocrRes)\r\n          // console.log('ocrRes: ', ocrRes)\r\n          // filter 返回包含学工号的对象的，一个 数组\r\n          let objs = ocrRes.filter(item => {\r\n            return item.text.indexOf('学工号') != -1;\r\n          })\r\n          // 寻找学工号的下标，进而确定姓名的下标\r\n          let stuNumIndex = -1;\r\n          ocrRes.forEach((each, index) => {\r\n            if (each.text == objs[0].text) {\r\n              stuNumIndex = index\r\n            }\r\n          })\r\n          console.log('stuNumIndex: ', stuNumIndex)\r\n          // obj={text:'学工号:20020007003'}\r\n          this.ocrResStuNum = objs[0].text.split(':')[1];\r\n          console.log('this.ocrResStuNum: ', this.ocrResStuNum)\r\n          this.ocrResName = ocrRes[stuNumIndex - 1].text;\r\n          console.log('this.ocrResName: ', this.ocrResName)\r\n          // console.log('this.ocrResStuNum: ', this.ocrResStuNum)\r\n          // ocr识别结束，将变量置为false\r\n          this.ocring = false;\r\n\r\n        }).catch(err => {\r\n          console.error('invokeService fail', err)\r\n          wx.showModal({\r\n            title: 'fail',\r\n            content: err + '',\r\n          })\r\n        })\r\n      },\r\n\r\n      // 发布按钮点击事件\r\n      async MyUpload() {\r\n        // 如果正在发布，等待。\r\n        if (this.uploading == true) {\r\n          return;\r\n        }\r\n\r\n        // 先验证信息是否输入完整，暂时注释\r\n        if (this.classes == 0) {\r\n          return uni.$showMsg('请选择物品类型')\r\n        } else if (this.itemName == '') {\r\n          return uni.$showMsg('请输入物品名称')\r\n        } else if (this.description == '') {\r\n          return uni.$showMsg(`为了更快地找到${this.query.type == 1 ? '物品' : '失主'},请输入必要的描述信息`)\r\n        } else if (this.time == '') {\r\n          return uni.$showMsg(`请输入${this.query.type == 1 ? '遗失' : '拾到'}时间`)\r\n        }\r\n\r\n        this.uploading = true;\r\n\r\n        // 如果没有图片，则不执行以下函数\r\n        if (this.md5Arr.length != 0) {\r\n          // 上传图片到 OSS\r\n          // 显示加载中\r\n          // uni.showLoading({\r\n          //   title: '上传图片中'\r\n          // })\r\n          this.uploadToOSS()\r\n        }\r\n\r\n        // 图片的上传需要时间\r\n        // 设置定时器，每隔一段时间判断图片是否上传完成\r\n        let intv = setInterval(check, 500);\r\n\r\n        let that = this;\r\n\r\n        async function check() {\r\n          if (that.uploadImgs.length === that.$data.tempPaths.length) {\r\n            // clearInterval(intv);\r\n            console.log(\"上传完成\");\r\n            // 关闭加载动画\r\n            // uni.hideLoading();\r\n\r\n            // 判断是否需要OCR，如果需要，则上传并继续等待。\r\n            // 需要ocr，并且已经 ocr 完成\r\n            if (that.classes == 9 && that.ocring == false) {\r\n              console.log('that.ocring: ', that.ocring)\r\n              console.log('ocrResStuNum', that.ocrResStuNum);\r\n\r\n              // 关闭 ocr 加载动画\r\n              // uni.hideLoading()\r\n\r\n              clearInterval(intv);\r\n              that.uploadPost();\r\n            }\r\n            // 需要ocr，并且已经 ocr== null，表示还未开始\r\n            if (that.classes == 9 && that.ocring == null) {\r\n              console.log('that.ocring: ', that.ocring)\r\n              // 启动加载动画\r\n              // uni.showLoading({\r\n              //   title: 'ocr识别中...'\r\n              // })\r\n              that.getOcr();\r\n            }\r\n            // 如果 ocr==true，表示正在ocr，什么也不做。\r\n            // 不需要进行 ocr 识别\r\n            else if (that.classes != 9) {\r\n              // 清除定时器\r\n              clearInterval(intv);\r\n              // 直接上传帖子\r\n              that.uploadPost();\r\n            }\r\n\r\n          }\r\n        }\r\n\r\n\r\n\r\n\r\n\r\n      },\r\n\r\n      // 向后端传递帖子，仅仅包含上传帖子的代码\r\n      async uploadPost() {\r\n\r\n        // uni.showLoading({\r\n        //   title: '上传帖子中'\r\n        // })\r\n        // 发送上传帖子的请求：        \r\n        // 定义请求参数\r\n        let postItem = {}\r\n        postItem.type = this.query.type;\r\n        postItem.name = this.itemName;\r\n        postItem.time = this.time;\r\n        postItem.position = this.position;\r\n        // color默认无。\r\n        postItem.color = this.itemColor == '' ? '无' : this.itemColor;\r\n        postItem.describe = this.description;\r\n        postItem.kindID = this.classes;\r\n        postItem.openid = this.token;\r\n        postItem.picture_address = this.uploadImgs;\r\n\r\n        let query = null;\r\n        // 如果是校园卡，则额外上传 query，表示校园卡的姓名和学号\r\n        if (this.classes == 9) {\r\n          query = {};\r\n          query['stuNum'] = this.ocrResStuNum;\r\n          query['stuName'] = this.ocrResName;\r\n        }\r\n\r\n        const {\r\n          data: res\r\n        } = await uni.$http.post('/addposts/', {\r\n          postitem: postItem,\r\n          query: query\r\n        })\r\n        console.log('res', res);\r\n        // 关闭上传状态\r\n        this.uploading = false;\r\n\r\n        if (res.code == 200) {\r\n          // return uni.$showMsg('上传帖子成功！', 1500, 'success')\r\n          // // 跳转到发布成功页面\r\n          uni.redirectTo({\r\n            // url: '/subpkg/uploadSuccess/uploadSuccess'\r\n            url: '/subpkg/uploadSuccess/uploadSuccess?type=' + res.type + '&postId=' + res['post_ID']\r\n          }).catch(() => {\r\n            return uni.$showMsg(err)\r\n          })\r\n        }\r\n      },\r\n\r\n      // 物品类型选择，kind 表示是第几级类型\r\n      selectChange(event) {\r\n        console.log(event);\r\n        // 如果一级导航 不是其他，则需要显示二级导航\r\n        // if (kind == 1 && this.curFstID) {\r\n\r\n        // } else {\r\n\r\n        // }\r\n      },\r\n      onchange(e) {\r\n        console.log('onchange:', e);\r\n        // 判断是否是校园卡，如果是，就显示弹窗，提示用户\r\n        // 上传图片的注意事项\r\n        if (this.classes == 9) {\r\n          uni.showModal({\r\n            title: '提示',\r\n            content: this.stuCardText,\r\n            showCancel: false,\r\n            success: function(res) {\r\n              if (res.confirm) {\r\n                console.log('用户点击确定');\r\n              }\r\n            }\r\n          });\r\n        }\r\n      },\r\n\r\n      // 选择地点点击事件\r\n      addressClickHandler() {\r\n        // 获取位置\r\n        // uni.chooseLocation({\r\n        //   success: function(res) {\r\n        //     console.log('位置名称：' + res.name);\r\n        //     console.log('详细地址：' + res.address);\r\n        //     console.log('纬度：' + res.latitude);\r\n        //     console.log('经度：' + res.longitude);\r\n        //   }\r\n        // })\r\n      }\r\n\r\n    },\r\n    computed: {\r\n      // 物品类型导航\r\n      ...mapState('m_user', ['leftNav', 'stuInfo', 'token']),\r\n    },\r\n    // 显示页面顶部标题\r\n    onLoad(options) {\r\n      this.query = options;\r\n      // 获取当日时间，用于时间选取\r\n      let d = new Date();\r\n      let year = d.getFullYear();\r\n      let month = d.getMonth() + 1;\r\n      let date = d.getDate();\r\n      this.$data.nowDate = year + '-' + month + '-' + date;\r\n      // this.$data.nowDate\r\n      // 在onLoad() 函数中修改。\r\n      if (this.query.type == 1) {\r\n        uni.setNavigationBarTitle({\r\n          title: '发布寻物启事'\r\n        })\r\n      } else {\r\n        uni.setNavigationBarTitle({\r\n          title: '发布招领启事'\r\n        })\r\n      }\r\n      this.dataTree = this.leftNav;\r\n    },\r\n\r\n    onReady() {\r\n\r\n      // 设置导航栏颜色\r\n      if (this.query.type == 1) {\r\n        uni.setNavigationBarColor({\r\n          frontColor: '#ffffff',\r\n          backgroundColor: '#add3e8'\r\n        })\r\n      } else {\r\n        uni.setNavigationBarColor({\r\n          frontColor: '#ffffff',\r\n          backgroundColor: '#f5c66a'\r\n        })\r\n      }\r\n\r\n    },\r\n  }\r\n</script>\r\n\r\n<style lang=\"scss\">\r\n  // 下拉菜单的样式\r\n  .uniDataPicker {\r\n    width: 100%;\r\n    // padding: 20rpx 0;\r\n  }\r\n\r\n  .input-value {\r\n    padding: 5px 10px !important;\r\n  }\r\n\r\n  // 高度撑满 \r\n  page {\r\n    height: 100%;\r\n  }\r\n\r\n  .container {\r\n    background-color: #eef2f4;\r\n    // height: 100%;\r\n    padding-bottom: 100px;\r\n\r\n    .infoBox {\r\n      width: 700rpx;\r\n      background-color: #eef4f7;\r\n      border-radius: 20rpx 20rpx 20rpx 20rpx;\r\n      margin: 0 auto;\r\n      padding-top: 60rpx;\r\n\r\n      .infoBoxItem {\r\n        margin-bottom: 40rpx;\r\n        border-radius: 20rpx;\r\n        padding: 36rpx 0rpx;\r\n        padding-right: 30px;\r\n        position: relative;\r\n        display: flex;\r\n        justify-content: flex-start;\r\n        align-items: center;\r\n        background-color: #fff;\r\n\r\n        .textbox {\r\n          min-width: 220rpx;\r\n          display: flex;\r\n\r\n          .infoText {\r\n            font-size: 30rpx;\r\n            font-family: PingFangSC-light;\r\n            margin-left: 36rpx;\r\n            color: #000;\r\n\r\n            .smallText {\r\n              font-size: 28rpx;\r\n            }\r\n          }\r\n        }\r\n\r\n        input {\r\n          font-size: 32rpx;\r\n          font-family: PingFangSC-light;\r\n        }\r\n      }\r\n\r\n      .teleBox::after {\r\n        display: none;\r\n      }\r\n\r\n      // 文件上传盒子\r\n      .uni-file-picker {\r\n        // width: 450rpx;\r\n      }\r\n    }\r\n\r\n    .upBtn {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: center;\r\n      width: 127px;\r\n      // height: 34px;\r\n      background-color: #f3d18b;\r\n      // line-height: 34px;\r\n      margin-top: 30px;\r\n      border-radius: 20px;\r\n      border: none;\r\n      outline: none;\r\n      // padding: 8px 0px;\r\n\r\n      text {\r\n        font-size: 20px;\r\n        color: #101010;\r\n      }\r\n    }\r\n  }\r\n</style>\n","import mod from \"-!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uploadGoods.vue?vue&type=style&index=0&lang=scss&\"; export default mod; export * from \"-!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uploadGoods.vue?vue&type=style&index=0&lang=scss&\"","import 'uni-pages';\n// @ts-ignore\nwx.__webpack_require_UNI_MP_PLUGIN__ = __webpack_require__;\nimport Vue from 'vue'\nimport Page from './subpkg/uploadGoods/uploadGoods.vue'\ncreatePage(Page)"],"sourceRoot":""}