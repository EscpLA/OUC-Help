{"version":3,"sources":["webpack:///C:/Users/hp/Documents/HBuilderProjects/OUC_help/uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.vue?869b","webpack:///C:/Users/hp/Documents/HBuilderProjects/OUC_help/uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.vue?2011","webpack:///C:/Users/hp/Documents/HBuilderProjects/OUC_help/uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.vue?ae66","webpack:///C:/Users/hp/Documents/HBuilderProjects/OUC_help/uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.vue?ef65","uni-app:///uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.vue","webpack:///C:/Users/hp/Documents/HBuilderProjects/OUC_help/uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.vue?f51f"],"names":["renderjs","component","options","__file","components","render","_vm","this","_h","$createElement","_self","_c","recyclableRender","staticRenderFns","_withStripped"],"mappings":"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","file":"uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./uni-file-picker.vue?vue&type=template&id=363ace0e&\"\nvar renderjs\nimport script from \"./uni-file-picker.vue?vue&type=script&lang=js&\"\nexport * from \"./uni-file-picker.vue?vue&type=script&lang=js&\"\nimport style0 from \"./uni-file-picker.vue?vue&type=style&index=0&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker.vue\"\nexport default component.exports","export * from \"-!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uni-file-picker.vue?vue&type=template&id=363ace0e&\"","var components\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uni-file-picker.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uni-file-picker.vue?vue&type=script&lang=js&\"","<template>\r\n  <view class=\"uni-file-picker\">\r\n    <view v-if=\"title\" class=\"uni-file-picker__header\">\r\n      <text class=\"file-title\">{{ title }}</text>\r\n      <text class=\"file-count\">{{ filesList.length }}/{{ limitLength }}</text>\r\n    </view>\r\n    <upload-image v-if=\"fileMediatype === 'image' && showType === 'grid'\" :readonly=\"readonly\"\r\n      :image-styles=\"imageStyles\" :files-list=\"filesList\" :limit=\"limitLength\" :disablePreview=\"disablePreview\"\r\n      :delIcon=\"delIcon\" @uploadFiles=\"uploadFiles\" @choose=\"choose\" @delFile=\"delFile\">\r\n      <slot>\r\n        <view class=\"is-add\">\r\n          <view class=\"icon-add\"></view>\r\n          <view class=\"icon-add rotate\"></view>\r\n        </view>\r\n      </slot>\r\n    </upload-image>\r\n    <upload-file v-if=\"fileMediatype !== 'image' || showType !== 'grid'\" :readonly=\"readonly\" :list-styles=\"listStyles\"\r\n      :files-list=\"filesList\" :showType=\"showType\" :delIcon=\"delIcon\" @uploadFiles=\"uploadFiles\" @choose=\"choose\"\r\n      @delFile=\"delFile\">\r\n      <slot><button type=\"primary\" size=\"mini\">选择文件</button></slot>\r\n    </upload-file>\r\n  </view>\r\n</template>\r\n\r\n<script>\r\n  import {\r\n    chooseAndUploadFile,\r\n    uploadCloudFiles\r\n  } from './choose-and-upload-file.js'\r\n  import {\r\n    get_file_ext,\r\n    get_extname,\r\n    get_files_and_is_max,\r\n    get_file_info,\r\n    get_file_data\r\n  } from './utils.js'\r\n  import uploadImage from './upload-image.vue'\r\n  import uploadFile from './upload-file.vue'\r\n  let fileInput = null\r\n  /**\r\n   * FilePicker 文件选择上传\r\n   * @description 文件选择上传组件，可以选择图片、视频等任意文件并上传到当前绑定的服务空间\r\n   * @tutorial https://ext.dcloud.net.cn/plugin?id=4079\r\n   * @property {Object|Array}\tvalue\t组件数据，通常用来回显 ,类型由return-type属性决定\r\n   * @property {Boolean}\tdisabled = [true|false]\t组件禁用\r\n   * \t@value true \t禁用\r\n   * \t@value false \t取消禁用\r\n   * @property {Boolean}\treadonly = [true|false]\t组件只读，不可选择，不显示进度，不显示删除按钮\r\n   * \t@value true \t只读\r\n   * \t@value false \t取消只读\r\n   * @property {String}\treturn-type = [array|object]\t限制 value 格式，当为 object 时 ，组件只能单选，且会覆盖\r\n   * \t@value array\t规定 value 属性的类型为数组\r\n   * \t@value object\t规定 value 属性的类型为对象\r\n   * @property {Boolean}\tdisable-preview = [true|false]\t禁用图片预览，仅 mode:grid 时生效\r\n   * \t@value true \t禁用图片预览\r\n   * \t@value false \t取消禁用图片预览\r\n   * @property {Boolean}\tdel-icon = [true|false]\t是否显示删除按钮\r\n   * \t@value true \t显示删除按钮\r\n   * \t@value false \t不显示删除按钮\r\n   * @property {Boolean}\tauto-upload = [true|false]\t是否自动上传，值为true则只触发@select,可自行上传\r\n   * \t@value true \t自动上传\r\n   * \t@value false \t取消自动上传\r\n   * @property {Number|String}\tlimit\t最大选择个数 ，h5 会自动忽略多选的部分\r\n   * @property {String}\ttitle\t组件标题，右侧显示上传计数\r\n   * @property {String}\tmode = [list|grid]\t选择文件后的文件列表样式\r\n   * \t@value list \t列表显示\r\n   * \t@value grid \t宫格显示\r\n   * @property {String}\tfile-mediatype = [image|video|all]\t选择文件类型\r\n   * \t@value image\t只选择图片\r\n   * \t@value video\t只选择视频\r\n   * \t@value all\t\t选择所有文件\r\n   * @property {Array}\tfile-extname\t选择文件后缀，根据 file-mediatype 属性而不同\r\n   * @property {Object}\tlist-style\tmode:list 时的样式\r\n   * @property {Object}\timage-styles\t选择文件后缀，根据 file-mediatype 属性而不同\r\n   * @event {Function} select \t选择文件后触发\r\n   * @event {Function} progress 文件上传时触发\r\n   * @event {Function} success \t上传成功触发\r\n   * @event {Function} fail \t\t上传失败触发\r\n   * @event {Function} delete \t文件从列表移除时触发\r\n   */\r\n  export default {\r\n    name: 'uniFilePicker',\r\n    components: {\r\n      uploadImage,\r\n      uploadFile\r\n    },\r\n    emits: ['select', 'success', 'fail', 'progress', 'delete', 'update:modelValue', 'input'],\r\n    props: {\r\n      // #ifdef VUE3\r\n      modelValue: {\r\n        type: [Array, Object],\r\n        default () {\r\n          return []\r\n        }\r\n      },\r\n      // #endif\r\n\r\n      // #ifndef VUE3\r\n      value: {\r\n        type: [Array, Object],\r\n        default () {\r\n          return []\r\n        }\r\n      },\r\n      // #endif\r\n\r\n      disabled: {\r\n        type: Boolean,\r\n        default: false\r\n      },\r\n      disablePreview: {\r\n        type: Boolean,\r\n        default: false\r\n      },\r\n      delIcon: {\r\n        type: Boolean,\r\n        default: true\r\n      },\r\n      // 自动上传\r\n      autoUpload: {\r\n        type: Boolean,\r\n        default: true\r\n      },\r\n      // 最大选择个数 ，h5只能限制单选或是多选\r\n      limit: {\r\n        type: [Number, String],\r\n        default: 9\r\n      },\r\n      // 列表样式 grid | list | list-card\r\n      mode: {\r\n        type: String,\r\n        default: 'grid'\r\n      },\r\n      // 选择文件类型  image/video/all\r\n      fileMediatype: {\r\n        type: String,\r\n        default: 'image'\r\n      },\r\n      // 文件类型筛选\r\n      fileExtname: {\r\n        type: [Array, String],\r\n        default () {\r\n          return []\r\n        }\r\n      },\r\n      title: {\r\n        type: String,\r\n        default: ''\r\n      },\r\n      listStyles: {\r\n        type: Object,\r\n        default () {\r\n          return {\r\n            // 是否显示边框\r\n            border: true,\r\n            // 是否显示分隔线\r\n            dividline: true,\r\n            // 线条样式\r\n            borderStyle: {}\r\n          }\r\n        }\r\n      },\r\n      imageStyles: {\r\n        type: Object,\r\n        default () {\r\n          return {\r\n            width: 'auto',\r\n            height: 'auto'\r\n          }\r\n        }\r\n      },\r\n      readonly: {\r\n        type: Boolean,\r\n        default: false\r\n      },\r\n      returnType: {\r\n        type: String,\r\n        default: 'array'\r\n      },\r\n      sizeType: {\r\n        type: Array,\r\n        default () {\r\n          return ['original', 'compressed']\r\n        }\r\n      }\r\n    },\r\n    data() {\r\n      return {\r\n        files: [],\r\n        localValue: []\r\n      }\r\n    },\r\n    watch: {\r\n      // #ifndef VUE3\r\n      value: {\r\n        handler(newVal, oldVal) {\r\n          this.setValue(newVal, oldVal)\r\n        },\r\n        immediate: true\r\n      },\r\n      // #endif\r\n      // #ifdef VUE3\r\n      modelValue: {\r\n        handler(newVal, oldVal) {\r\n          this.setValue(newVal, oldVal)\r\n        },\r\n        immediate: true\r\n      },\r\n      // #endif\r\n    },\r\n    computed: {\r\n      filesList() {\r\n        let files = []\r\n        this.files.forEach(v => {\r\n          files.push(v)\r\n        })\r\n        return files\r\n      },\r\n      showType() {\r\n        if (this.fileMediatype === 'image') {\r\n          return this.mode\r\n        }\r\n        return 'list'\r\n      },\r\n      limitLength() {\r\n        if (this.returnType === 'object') {\r\n          return 1\r\n        }\r\n        if (!this.limit) {\r\n          return 1\r\n        }\r\n        if (this.limit >= 9) {\r\n          return 9\r\n        }\r\n        return this.limit\r\n      }\r\n    },\r\n    created() {\r\n      // TODO 兼容不开通服务空间的情况\r\n      if (!(uniCloud.config && uniCloud.config.provider)) {\r\n        this.noSpace = true\r\n        uniCloud.chooseAndUploadFile = chooseAndUploadFile\r\n      }\r\n      this.form = this.getForm('uniForms')\r\n      this.formItem = this.getForm('uniFormsItem')\r\n      if (this.form && this.formItem) {\r\n        if (this.formItem.name) {\r\n          this.rename = this.formItem.name\r\n          this.form.inputChildrens.push(this)\r\n        }\r\n      }\r\n    },\r\n    methods: {\r\n      /**\r\n       * 公开用户使用，清空文件\r\n       * @param {Object} index\r\n       */\r\n      clearFiles(index) {\r\n        if (index !== 0 && !index) {\r\n          this.files = []\r\n          this.$nextTick(() => {\r\n            this.setEmit()\r\n          })\r\n        } else {\r\n          this.files.splice(index, 1)\r\n        }\r\n        this.$nextTick(() => {\r\n          this.setEmit()\r\n        })\r\n      },\r\n      /**\r\n       * 公开用户使用，继续上传\r\n       */\r\n      upload() {\r\n        let files = []\r\n        this.files.forEach((v, index) => {\r\n          if (v.status === 'ready' || v.status === 'error') {\r\n            files.push(Object.assign({}, v))\r\n          }\r\n        })\r\n        return this.uploadFiles(files)\r\n      },\r\n      async setValue(newVal, oldVal) {\r\n        const newData = async (v) => {\r\n          const reg = /cloud:\\/\\/([\\w.]+\\/?)\\S*/\r\n          let url = ''\r\n          if (v.fileID) {\r\n            url = v.fileID\r\n          } else {\r\n            url = v.url\r\n          }\r\n          if (reg.test(url)) {\r\n            v.fileID = url\r\n            v.url = await this.getTempFileURL(url)\r\n          }\r\n          if (v.url) v.path = v.url\r\n          return v\r\n        }\r\n        if (this.returnType === 'object') {\r\n          if (newVal) {\r\n            await newData(newVal)\r\n          } else {\r\n            newVal = {}\r\n          }\r\n        } else {\r\n          if (!newVal) newVal = []\r\n          for (let i = 0; i < newVal.length; i++) {\r\n            let v = newVal[i]\r\n            await newData(v)\r\n          }\r\n        }\r\n        this.localValue = newVal\r\n        if (this.form && this.formItem && !this.is_reset) {\r\n          this.is_reset = false\r\n          this.formItem.setValue(this.localValue)\r\n        }\r\n        let filesData = Object.keys(newVal).length > 0 ? newVal : [];\r\n        this.files = [].concat(filesData)\r\n      },\r\n\r\n      /**\r\n       * 选择文件\r\n       */\r\n      choose() {\r\n\r\n        if (this.disabled) return\r\n        if (this.files.length >= Number(this.limitLength) && this.showType !== 'grid' && this.returnType ===\r\n          'array') {\r\n          uni.showToast({\r\n            title: `您最多选择 ${this.limitLength} 个文件`,\r\n            icon: 'none'\r\n          })\r\n          return\r\n        }\r\n        this.chooseFiles()\r\n      },\r\n\r\n      /**\r\n       * 选择文件并上传\r\n       */\r\n      chooseFiles() {\r\n        const _extname = get_extname(this.fileExtname)\r\n        // 获取后缀\r\n        uniCloud\r\n          .chooseAndUploadFile({\r\n            type: this.fileMediatype,\r\n            compressed: false,\r\n            sizeType: this.sizeType,\r\n            // TODO 如果为空，video 有问题\r\n            extension: _extname.length > 0 ? _extname : undefined,\r\n            count: this.limitLength - this.files.length, //默认9\r\n            onChooseFile: this.chooseFileCallback,\r\n            onUploadProgress: progressEvent => {\r\n              this.setProgress(progressEvent, progressEvent.index)\r\n            }\r\n          })\r\n          .then(result => {\r\n            this.setSuccessAndError(result.tempFiles)\r\n          })\r\n          .catch(err => {\r\n            console.log('选择失败', err)\r\n          })\r\n      },\r\n\r\n      /**\r\n       * 选择文件回调\r\n       * @param {Object} res\r\n       */\r\n      async chooseFileCallback(res) {\r\n        const _extname = get_extname(this.fileExtname)\r\n        const is_one = (Number(this.limitLength) === 1 &&\r\n            this.disablePreview &&\r\n            !this.disabled) ||\r\n          this.returnType === 'object'\r\n        // 如果这有一个文件 ，需要清空本地缓存数据\r\n        if (is_one) {\r\n          this.files = []\r\n        }\r\n\r\n        let {\r\n          filePaths,\r\n          files\r\n        } = get_files_and_is_max(res, _extname)\r\n        if (!(_extname && _extname.length > 0)) {\r\n          filePaths = res.tempFilePaths\r\n          files = res.tempFiles\r\n        }\r\n\r\n        let currentData = []\r\n        for (let i = 0; i < files.length; i++) {\r\n          if (this.limitLength - this.files.length <= 0) break\r\n          files[i].uuid = Date.now()\r\n          let filedata = await get_file_data(files[i], this.fileMediatype)\r\n          filedata.progress = 0\r\n          filedata.status = 'ready'\r\n          this.files.push(filedata)\r\n          currentData.push({\r\n            ...filedata,\r\n            file: files[i]\r\n          })\r\n        }\r\n        this.$emit('select', {\r\n          tempFiles: currentData,\r\n          tempFilePaths: filePaths\r\n        })\r\n        res.tempFiles = files\r\n        // 停止自动上传\r\n        if (!this.autoUpload || this.noSpace) {\r\n          res.tempFiles = []\r\n        }\r\n      },\r\n\r\n      /**\r\n       * 批传\r\n       * @param {Object} e\r\n       */\r\n      uploadFiles(files) {\r\n        files = [].concat(files)\r\n        return uploadCloudFiles.call(this, files, 5, res => {\r\n            this.setProgress(res, res.index, true)\r\n          })\r\n          .then(result => {\r\n            this.setSuccessAndError(result)\r\n            return result;\r\n          })\r\n          .catch(err => {\r\n            console.log(err)\r\n          })\r\n      },\r\n\r\n      /**\r\n       * 成功或失败\r\n       */\r\n      async setSuccessAndError(res, fn) {\r\n        let successData = []\r\n        let errorData = []\r\n        let tempFilePath = []\r\n        let errorTempFilePath = []\r\n        for (let i = 0; i < res.length; i++) {\r\n          const item = res[i]\r\n          const index = item.uuid ? this.files.findIndex(p => p.uuid === item.uuid) : item.index\r\n\r\n          if (index === -1 || !this.files) break\r\n          if (item.errMsg === 'request:fail') {\r\n            this.files[index].url = item.path\r\n            this.files[index].status = 'error'\r\n            this.files[index].errMsg = item.errMsg\r\n            // this.files[index].progress = -1\r\n            errorData.push(this.files[index])\r\n            errorTempFilePath.push(this.files[index].url)\r\n          } else {\r\n            this.files[index].errMsg = ''\r\n            this.files[index].fileID = item.url\r\n            const reg = /cloud:\\/\\/([\\w.]+\\/?)\\S*/\r\n            if (reg.test(item.url)) {\r\n              this.files[index].url = await this.getTempFileURL(item.url)\r\n            } else {\r\n              this.files[index].url = item.url\r\n            }\r\n\r\n            this.files[index].status = 'success'\r\n            this.files[index].progress += 1\r\n            successData.push(this.files[index])\r\n            tempFilePath.push(this.files[index].fileID)\r\n          }\r\n        }\r\n\r\n        if (successData.length > 0) {\r\n          this.setEmit()\r\n          // 状态改变返回\r\n          this.$emit('success', {\r\n            tempFiles: this.backObject(successData),\r\n            tempFilePaths: tempFilePath\r\n          })\r\n        }\r\n\r\n        if (errorData.length > 0) {\r\n          this.$emit('fail', {\r\n            tempFiles: this.backObject(errorData),\r\n            tempFilePaths: errorTempFilePath\r\n          })\r\n        }\r\n      },\r\n\r\n      /**\r\n       * 获取进度\r\n       * @param {Object} progressEvent\r\n       * @param {Object} index\r\n       * @param {Object} type\r\n       */\r\n      setProgress(progressEvent, index, type) {\r\n        const fileLenth = this.files.length\r\n        const percentNum = (index / fileLenth) * 100\r\n        const percentCompleted = Math.round((progressEvent.loaded * 100) / progressEvent.total)\r\n        let idx = index\r\n        if (!type) {\r\n          idx = this.files.findIndex(p => p.uuid === progressEvent.tempFile.uuid)\r\n        }\r\n        if (idx === -1 || !this.files[idx]) return\r\n        // fix by mehaotian 100 就会消失，-1 是为了让进度条消失\r\n        this.files[idx].progress = percentCompleted - 1\r\n        // 上传中\r\n        this.$emit('progress', {\r\n          index: idx,\r\n          progress: parseInt(percentCompleted),\r\n          tempFile: this.files[idx]\r\n        })\r\n      },\r\n\r\n      /**\r\n       * 删除文件\r\n       * @param {Object} index\r\n       */\r\n      delFile(index) {\r\n        this.$emit('delete', {\r\n          tempFile: this.files[index],\r\n          tempFilePath: this.files[index].url\r\n        })\r\n        this.files.splice(index, 1)\r\n        this.$nextTick(() => {\r\n          this.setEmit()\r\n        })\r\n      },\r\n\r\n      /**\r\n       * 获取文件名和后缀\r\n       * @param {Object} name\r\n       */\r\n      getFileExt(name) {\r\n        const last_len = name.lastIndexOf('.')\r\n        const len = name.length\r\n        return {\r\n          name: name.substring(0, last_len),\r\n          ext: name.substring(last_len + 1, len)\r\n        }\r\n      },\r\n\r\n      /**\r\n       * 处理返回事件\r\n       */\r\n      setEmit() {\r\n        let data = []\r\n        if (this.returnType === 'object') {\r\n          data = this.backObject(this.files)[0]\r\n          this.localValue = data ? data : null\r\n        } else {\r\n          data = this.backObject(this.files)\r\n          if (!this.localValue) {\r\n            this.localValue = []\r\n          }\r\n          this.localValue = [...data]\r\n        }\r\n        // #ifdef VUE3\r\n        this.$emit('update:modelValue', this.localValue)\r\n        // #endif\r\n        // #ifndef VUE3\r\n        this.$emit('input', this.localValue)\r\n        // #endif\r\n      },\r\n\r\n      /**\r\n       * 处理返回参数\r\n       * @param {Object} files\r\n       */\r\n      backObject(files) {\r\n        let newFilesData = []\r\n        files.forEach(v => {\r\n          newFilesData.push({\r\n            extname: v.extname,\r\n            fileType: v.fileType,\r\n            image: v.image,\r\n            name: v.name,\r\n            path: v.path,\r\n            size: v.size,\r\n            fileID: v.fileID,\r\n            url: v.url\r\n          })\r\n        })\r\n        return newFilesData\r\n      },\r\n      async getTempFileURL(fileList) {\r\n        fileList = {\r\n          fileList: [].concat(fileList)\r\n        }\r\n        const urls = await uniCloud.getTempFileURL(fileList)\r\n        return urls.fileList[0].tempFileURL || ''\r\n      },\r\n      /**\r\n       * 获取父元素实例\r\n       */\r\n      getForm(name = 'uniForms') {\r\n        let parent = this.$parent;\r\n        let parentName = parent.$options.name;\r\n        while (parentName !== name) {\r\n          parent = parent.$parent;\r\n          if (!parent) return false;\r\n          parentName = parent.$options.name;\r\n        }\r\n        return parent;\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style>\r\n  .uni-file-picker {\r\n    /* #ifndef APP-NVUE */\r\n    box-sizing: border-box;\r\n    overflow: hidden;\r\n    /* #endif */\r\n  }\r\n\r\n  .uni-file-picker__header {\r\n    padding-top: 5px;\r\n    padding-bottom: 10px;\r\n    /* #ifndef APP-NVUE */\r\n    display: flex;\r\n    /* #endif */\r\n    justify-content: space-between;\r\n  }\r\n\r\n  .file-title {\r\n    font-size: 14px;\r\n    color: #333;\r\n  }\r\n\r\n  .file-count {\r\n    font-size: 14px;\r\n    color: #999;\r\n  }\r\n\r\n  .is-add {\r\n    /* #ifndef APP-NVUE */\r\n    display: flex;\r\n    /* #endif */\r\n    align-items: center;\r\n    justify-content: center;\r\n  }\r\n\r\n  .icon-add {\r\n    width: 50px;\r\n    height: 5px;\r\n    background-color: #f1f1f1;\r\n    border-radius: 2px;\r\n  }\r\n\r\n  .rotate {\r\n    position: absolute;\r\n    transform: rotate(90deg);\r\n  }\r\n</style>\n","import mod from \"-!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uni-file-picker.vue?vue&type=style&index=0&lang=css&\"; export default mod; export * from \"-!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--6-oneOf-1-0!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--6-oneOf-1-1!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--6-oneOf-1-2!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--6-oneOf-1-3!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!D:\\\\HBuilderX.3.3.13.20220314\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./uni-file-picker.vue?vue&type=style&index=0&lang=css&\""],"sourceRoot":""}